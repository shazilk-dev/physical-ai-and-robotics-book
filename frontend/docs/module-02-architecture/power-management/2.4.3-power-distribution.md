---
sidebar_position: 3
title: 2.4.3 Power Distribution & Regulation
---

# 2.4.3 Power Distribution - From Battery to Components

## Introduction

**Problem:** Your robot has a 36V battery, but needs:
- 5V for Jetson Orin
- 12V for motors
- 3.3V for sensors
- 24V for high-power actuators

**Solution:** **DC-DC converters** (buck/boost) efficiently convert battery voltage to whatever each component needs.

In this section, you'll learn:
- Buck vs boost converter operation
- Selecting DC-DC converters for robot loads
- Power distribution board design
- Grounding and noise filtering

---

## Voltage Regulation Fundamentals

### Why We Need Voltage Regulators

**Battery Voltage Varies:**
```
10S Li-ion pack:
- Fully charged: 42.0V
- Nominal: 36.0V
- Depleted: 30.0V

Problem: Jetson needs stable 5V (Â±5%) â†’ 4.75V to 5.25V
If you connect 36V battery directly â†’ BOOM! ğŸ’¥ (destroyed Jetson)
```

**Solution:** Voltage regulator converts variable battery voltage to stable output.

---

### Linear vs Switching Regulators

| Type | Efficiency | Heat Generated | Cost | Noise |
|------|-----------|----------------|------|-------|
| **Linear (LDO)** | 40-60% | High | $ | Very low |
| **Switching (Buck/Boost)** | 85-95% | Low | $$ | Medium (requires filtering) |

**For Robotics:** **Switching regulators** (much more efficient â†’ less heat, longer battery life).

---

## Buck Converters (Step-Down)

### How Buck Converters Work

**Principle:** Chop input voltage with high-frequency switch, filter with inductor + capacitor.

```
Input (36V) â”€â”€â”¬â”€â”€[Switch]â”€â”€â”¬â”€â”€[Inductor]â”€â”€ Output (5V)
              â”‚            â”‚
             GND         [Cap]
                          â”‚
                         GND

Switch duty cycle = Output / Input = 5V / 36V = 14%
```

**Key Components:**
1. **MOSFET Switch:** Turns on/off at 100-500 kHz
2. **Inductor:** Stores energy when switch is on, releases when off
3. **Capacitor:** Smooths output voltage (reduces ripple)
4. **Diode (or sync MOSFET):** Provides current path when switch is off

---

### Buck Converter Selection

**Key Specifications:**

| Parameter | Typical Value | Notes |
|-----------|---------------|-------|
| **Input Voltage Range** | 30-45V | Must cover battery min/max |
| **Output Voltage** | 5V, 12V, 24V | Set by resistor divider |
| **Max Output Current** | 5-20A | Must exceed load + 20% margin |
| **Efficiency** | 85-95% | Higher is better (less heat) |
| **Switching Frequency** | 200-500 kHz | Higher = smaller inductor, more noise |
| **Output Ripple** | < 50 mV | Lower is better for sensitive electronics |

---

### Example: 5V Rail for Jetson Orin

**Requirements:**
```
Load: Jetson Orin (max 15W @ 5V = 3A)
Input: 30-42V (10S Li-ion)
Output: 5V Â±2% (4.9-5.1V)
```

**Recommended Module:** **TI TPS54620** (6A, 95% efficiency, $8)

**Circuit:**
```
36V Battery â”€â”€â”¬â”€â”€[100uF Cap]â”€â”€[TPS54620]â”€â”€[10uF Cap]â”€â”€ 5V Output (to Jetson)
              â”‚                   â”‚
             GND                 GND

Output current: 3A nominal, 6A available (2Ã— headroom for peaks)
Efficiency: 94% (0.18W heat dissipation)
```

---

## Boost Converters (Step-Up)

### When to Use Boost Converters

**Scenario:** Battery voltage drops below required voltage.

**Example:**
```
USB power bank (3.7V Li-ion cell) â†’ Boost to 5V for Raspberry Pi
Robot battery (12V) â†’ Boost to 24V for high-torque motor driver
```

---

### Boost Converter Operation

**Principle:** Store energy in inductor, release at higher voltage.

```
Input (12V) â”€â”€[Inductor]â”€â”€â”¬â”€â”€[Diode]â”€â”€ Output (24V)
                          â”‚
                      [Switch]
                          â”‚
                         GND

Duty cycle = 1 - (Input / Output) = 1 - (12/24) = 50%
```

**Key Limitation:** Output current < Input current (power is conserved!).

```
Power In = Power Out (ignoring losses)
12V Ã— I_in = 24V Ã— I_out
I_out = (12 / 24) Ã— I_in = 0.5 Ã— I_in

If input current is 10A â†’ output current is only 5A!
```

---

### Boost Converter Example

**Requirement:** 24V @ 5A for motor driver (from 12V battery)

**Input Current:**
```
P_out = 24V Ã— 5A = 120W
With 90% efficiency:
P_in = 120W / 0.90 = 133W
I_in = 133W / 12V = 11.1A
```

**Recommended Module:** **Vicor BCM** (12Vâ†’24V, 150W, 95% efficiency, $85)

---

## Buck-Boost Converters (Step-Up or Step-Down)

### Use Case

**Problem:** Battery voltage crosses the required voltage during discharge.

**Example:**
```
6S Li-ion battery:
- Fully charged: 25.2V
- Nominal: 22.2V  â† Target: 24V for motor
- Depleted: 18.0V

At full charge: Need buck (25.2V â†’ 24V)
At depletion: Need boost (18.0V â†’ 24V)
```

**Solution:** **Buck-boost converter** (can step up OR down as needed).

---

### Buck-Boost Topology

**SEPIC (Single-Ended Primary Inductor Converter):**
- Can output voltage higher or lower than input
- Efficiency: 85-90% (lower than pure buck or boost)
- More complex (two inductors)

**Recommended Module:** **Pololu D24V50F5** (4.5-45V input, 5V @ 5A output, $30)

**Use Case:** Robots with wide battery voltage range (e.g., 4S-6S LiPo, 14-25V).

---

## Power Distribution Board Design

### Centralized vs Distributed Architecture

**Centralized (Simpler):**
```
Battery â”€â†’ Power Distribution Board â”€â”¬â”€â†’ 5V Rail (Jetson, sensors)
                                     â”œâ”€â†’ 12V Rail (fans, cameras)
                                     â””â”€â†’ 36V Rail (motor drivers)

Pros: Single point of control, easier debugging
Cons: Single point of failure, long wire runs
```

**Distributed (Scalable):**
```
Battery â”€â”¬â”€â†’ Local Buck (Jetson)
         â”œâ”€â†’ Local Buck (Cameras)
         â””â”€â†’ Motor Drivers (direct battery connection)

Pros: Shorter wires (less voltage drop), redundancy
Cons: More complex wiring, harder to debug
```

**Humanoid Recommendation:** Centralized for prototypes, distributed for production.

---

### Power Distribution Board Schematic

**Example: 3-Rail System**

```
Battery (36V)
     â”‚
     â”œâ”€â”€â”€â”€â”€[100A Fuse]â”€â”€â”€â”€[Main Switch]â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                     â”‚                   â”‚
     â”‚                              [Buck 36Vâ†’12V, 10A]  [Buck 36Vâ†’5V, 5A]
     â”‚                                     â”‚                   â”‚
     â”‚                                  12V Rail             5V Rail
     â”‚                                     â”‚                   â”‚
     â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚            â”‚      â”‚            â”‚
     â”‚                            Fans      Cameras   Jetson     Sensors
     â”‚
  [Motor ESCs (direct 36V connection)]
     â”‚
  [12Ã— BLDC Motors]
```

**Key Features:**
1. **Main fuse (100A):** Protects against short circuit
2. **Main switch:** Emergency cutoff
3. **Separate rails:** Isolates noisy loads (motors) from sensitive electronics
4. **Direct motor connection:** Motors use battery voltage (no conversion needed)

---

### Current Capacity Planning

**Load Table:**

| Component | Voltage | Current (A) | Power (W) | Converter |
|-----------|---------|-------------|-----------|-----------|
| **Jetson Orin** | 5V | 3A | 15W | Buck 36Vâ†’5V (5A) |
| **RealSense (4Ã—)** | 12V | 1.5A | 18W | Buck 36Vâ†’12V (10A) |
| **Fans (2Ã—)** | 12V | 0.5A | 6W | (same 12V rail) |
| **IMU** | 3.3V | 0.05A | 0.2W | LDO 5Vâ†’3.3V |
| **Motor ESCs (12Ã—)** | 36V | 50A peak | 1800W | Direct battery |

**Converter Sizing:**
```
5V Rail:
- Load: 3A (Jetson) + 0.05A (IMU via LDO) = 3.05A
- Converter: 5A (65% headroom) âœ…

12V Rail:
- Load: 1.5A (cameras) + 0.5A (fans) = 2A
- Converter: 10A (5Ã— headroom for camera inrush current) âœ…
```

---

## Voltage Drop Calculations

### Why Wire Gauge Matters

**Resistance of Copper Wire:**
```
R = Ï Ã— L / A

Where:
- Ï = Resistivity of copper (1.68Ã—10â»â¸ Î©Â·m)
- L = Wire length (m)
- A = Cross-sectional area (mÂ²)

For 18 AWG wire (1.02 mmÂ² cross-section):
R = 1.68Ã—10â»â¸ Ã— 1m / (1.02Ã—10â»â¶) = 0.0165 Î©/m
```

---

### Voltage Drop Example

**Scenario:** 5V rail, 1 meter wire run, 3A load

**Voltage Drop:**
```
Wire resistance: 0.0165 Î©/m Ã— 1m = 0.0165 Î©

Voltage drop (one-way):
V_drop = I Ã— R = 3A Ã— 0.0165 Î© = 0.05 V

Total drop (round-trip: positive + return):
V_drop_total = 2 Ã— 0.05V = 0.10V

Voltage at load:
V_load = 5.0V - 0.10V = 4.90V âœ… (within Â±5% spec)
```

**Design Rule:** Keep voltage drop < 3% of nominal voltage.

---

### Wire Gauge Selection Table

| AWG | Diameter (mm) | Resistance (Î©/m) | Max Current (Chassis) | Use Case |
|-----|---------------|------------------|----------------------|----------|
| **14** | 1.63 | 0.0083 | 32A | Motor power (high current) |
| **16** | 1.29 | 0.0132 | 22A | 12V rails |
| **18** | 1.02 | 0.0165 | 16A | 5V rails, sensors |
| **20** | 0.81 | 0.0263 | 11A | Signal wires |
| **22** | 0.64 | 0.0419 | 7A | Low-power sensors |

**Humanoid Recommendation:**
- Motor power: 14 AWG (short runs < 0.5m)
- 12V rails: 16 AWG
- 5V rails: 18 AWG

---

## Grounding & Noise Mitigation

### Single-Point vs Multi-Point Grounding

**Single-Point (Star) Ground:**
```
Battery GND â”€â”€â”¬â”€â†’ Jetson GND
              â”œâ”€â†’ Camera GND
              â””â”€â†’ Motor Driver GND (via separate wire!)

Pros: No ground loops (avoids noise coupling)
Cons: Long ground wires (increases impedance at high frequency)
```

**Multi-Point Ground:**
```
Battery GND â”€â”€â”¬â”€â†’ Jetson GND â”€â”€â”¬â”€â†’ Camera GND
              â”‚                â””â”€â†’ Sensor GND
              â””â”€â†’ Motor Driver GND

Pros: Shorter ground wires (lower impedance)
Cons: Potential ground loops (noise from motors enters sensor ground)
```

**Best Practice for Robots:**
- **Low-frequency (<1 kHz):** Star ground (motors separate from sensors)
- **High-frequency (>1 MHz):** Multi-point ground (avoid EMI from long wires)

**Hybrid Approach (Recommended):**
```
Battery GND â”€â”€â”¬â”€â†’ [Digital Ground Plane] â”€â†’ Jetson, sensors
              â””â”€â†’ [Motor Ground Plane] â”€â†’ ESCs, motors (isolated!)
```

---

### Common Mode Noise Filtering

**Problem:** Motor switching creates voltage spikes on power rails.

```
Motor ESC switches at 20 kHz â†’ 20 kHz ripple on 36V rail
This couples into 5V rail via parasitic capacitance â†’ Jetson sees noise!
```

**Solution: LC Filter (Low-Pass)**

```
36V from Battery â”€â”€[Inductor 10uH]â”€â”€â”¬â”€â”€[Cap 100uF]â”€â”€ 36V to Motors
                                    â”‚
                                   GND

Cutoff frequency:
f_c = 1 / (2Ï€âˆš(LC))
f_c = 1 / (2Ï€âˆš(10Ã—10â»â¶ Ã— 100Ã—10â»â¶)) = 1591 Hz

Blocks 20 kHz noise âœ…, passes DC and low-frequency motor currents âœ…
```

---

### Ferrite Beads

**Purpose:** Suppress high-frequency noise (MHz range) without affecting DC/low-frequency signals.

**Placement:**
```
5V Rail â”€â”€[Ferrite Bead]â”€â”€ Jetson Orin

Impedance:
- DC (0 Hz): 0 Î© (no voltage drop)
- 100 kHz: 10 Î©
- 10 MHz: 600 Î© (blocks EMI from switching supplies)
```

**Recommended Part:** Murata BLM18 series (cheap, effective, $0.10 each)

**Use Case:** On every power rail before sensitive electronics (Jetson, IMU, cameras).

---

## Inrush Current Protection

### The Problem

**Capacitors act as short circuits when first connected:**

```
Jetson buck converter has 1000uF output cap

When battery is connected:
I_inrush = V / R_wire
I_inrush = 36V / 0.01Î© (wire resistance) = 3600A! âŒ

Result: Sparks at connector, potential weld/damage
```

---

### Solution: Soft-Start Circuit

**NTC Thermistor (Negative Temperature Coefficient):**
```
Battery â”€â”€[NTC Thermistor]â”€â”€ Power Distribution Board

Cold resistance: 10 Î© (limits inrush to 36V / 10Î© = 3.6A âœ…)
Hot resistance: 0.1 Î© (minimal loss during operation)
```

**How it works:**
1. Initially cold â†’ high resistance â†’ limits inrush
2. Current flows â†’ heats thermistor â†’ resistance drops
3. After 1-2 seconds â†’ thermistor is hot â†’ nearly zero resistance

**Recommended Part:** Ametherm SL32 (10Î©, 32A surge capacity, $3)

---

## E-Stop (Emergency Stop) Design

### Safety Requirements

**Must disconnect ALL power instantly (<100ms):**

```
E-Stop Button â”€â†’ Relay (NO contact) â”€â†’ Main Power

When pressed: Relay opens â†’ Battery disconnected from all loads
```

**Key Specs:**
- **Contact Rating:** 100A minimum (to handle motor inrush)
- **Normally Open (NO):** Fail-safe (if relay fails, power is OFF)
- **Mechanical Latching:** Requires manual reset (can't accidentally re-energize)

**Recommended Relay:** Tyco LEV200 (200A, 12V coil, $25)

---

### E-Stop Wiring

```
Battery (+) â”€â”€â”¬â”€â”€[Main Fuse 100A]â”€â”€[E-Stop Relay]â”€â”€â”¬â”€â”€ Power Distribution
             â”‚                                      â”‚
            GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GND

E-Stop Button â”€â”€[12V Coil]â”€â”€ Relay (when button pressed â†’ coil de-energized â†’ relay opens)
```

**Important:** E-Stop must be **red**, **large** (at least 40mm diameter), and **easily accessible**.

---

## Power Monitoring

### Why Monitor Power?

**Benefits:**
1. Battery state estimation (remaining runtime)
2. Fault detection (overcurrent â†’ short circuit)
3. Efficiency analysis (identify power-hungry components)

---

### Current Sensing

**Hall-Effect Current Sensor:**

```
36V Battery â”€â”€[ACS712]â”€â”€ Power Distribution
                â”‚
             Vout (analog voltage proportional to current)
                â”‚
             Jetson ADC

Output voltage:
V_out = 2.5V + (I Ã— Sensitivity)

For ACS712-50A:
Sensitivity = 40 mV/A
At 30A: V_out = 2.5V + (30A Ã— 0.040V/A) = 3.7V
```

**Python Code (ROS 2):**
```python
import Adafruit_ADS1x15  # 16-bit ADC

adc = Adafruit_ADS1x15.ADS1115()
GAIN = 1  # Â±4.096V range

def read_current():
    """Read current from ACS712 sensor"""
    raw = adc.read_adc(0, gain=GAIN)  # Channel 0
    voltage = raw * 4.096 / 32767  # Convert to volts

    # ACS712-50A: 2.5V offset, 40 mV/A sensitivity
    current = (voltage - 2.5) / 0.040

    return current

# Example usage
import time
while True:
    I = read_current()
    print(f"Battery current: {I:.2f} A")
    time.sleep(0.1)
```

---

### Power Calculation

**Integrate current and voltage:**

```python
def calculate_power(voltage, current):
    """Calculate instantaneous power"""
    return voltage * current  # Watts

def estimate_battery_soc(capacity_ah, current, dt):
    """Estimate State of Charge using coulomb counting"""
    # Integrate current over time
    charge_used = current * (dt / 3600)  # Ah (dt in seconds)

    # Update SoC
    soc_remaining = capacity_ah - charge_used

    return (soc_remaining / capacity_ah) * 100  # Percentage

# Example: 50 Ah battery
capacity = 50.0  # Ah
soc = 100  # Start at 100%

while True:
    V = read_voltage()  # From BMS
    I = read_current()  # From ACS712

    P = calculate_power(V, I)
    soc -= (I * 0.1 / 3600) / capacity * 100  # Update every 0.1 sec

    print(f"Power: {P:.1f}W, SoC: {soc:.1f}%")
    time.sleep(0.1)
```

---

## Summary

### Key Takeaways

1. âœ… **Buck converters** step down voltage (36Vâ†’5V) with 85-95% efficiency
2. âœ… **Boost converters** step up voltage but reduce output current
3. âœ… **Wire gauge** must be sized to limit voltage drop < 3%
4. âœ… **Star grounding** isolates noisy motor power from sensitive electronics
5. âœ… **LC filters** block motor switching noise from power rails
6. âœ… **E-stop relay** must disconnect all power instantly for safety

---

### Power Distribution Design Checklist

- [ ] Calculate power budget for each voltage rail
- [ ] Select buck/boost converters with 20-50% current headroom
- [ ] Choose wire gauge to limit voltage drop < 3%
- [ ] Implement star grounding (separate motor and digital grounds)
- [ ] Add LC filters on noisy rails (motor power)
- [ ] Install ferrite beads before sensitive components
- [ ] Use NTC thermistor or soft-start for inrush protection
- [ ] Design fail-safe E-stop circuit (NO relay)
- [ ] Add current sensing for power monitoring
- [ ] Test under full load (all motors + Jetson at 100%)

---

## Practice Problems

### Problem 1: Buck Converter Sizing

**Given:**
- Load: 12V @ 8A (continuous)
- Battery: 36V nominal (30-42V range)

**Calculate:**
1. Input current at 90% efficiency
2. Power dissipation in converter
3. Minimum wire gauge for 1m run (< 3% drop)

---

### Problem 2: Voltage Drop

**Scenario:**
- 5V rail, 18 AWG wire (0.0165 Î©/m)
- Wire length: 2 meters (round-trip = 4 meters effective)
- Load: 5A

**Calculate:**
1. Total voltage drop
2. Voltage at load
3. Is this acceptable? (5V Â±5% = 4.75-5.25V)

---

## Further Reading

### Recommended Resources

**Books:**
- "Switching Power Supply Design" - Pressman (Comprehensive SMPS theory)
- "High-Speed Digital Design" - Johnson & Graham (Grounding techniques)

**Application Notes:**
- [TI Power Supply Design Guide](https://www.ti.com/lit/an/slva059b/slva059b.pdf)
- [Analog Devices Grounding Best Practices](https://www.analog.com/en/analog-dialogue/articles/staying-well-grounded.html)

**Suppliers:**
- **Buck/Boost Converters:** Texas Instruments, Vicor, Pololu
- **Current Sensors:** Allegro (ACS712), LEM, Honeywell
- **Relays:** Tyco, Panasonic, Omron

---

## Next Steps

Congratulations! You've completed **Chapter 2.4: Power Management**.

You now understand:
- âœ… Battery systems and BMS design
- âœ… Thermal management and cooling
- âœ… Power distribution and voltage regulation

**Next:** **Lab 4: Motor Control with PID Tuning** - Put your knowledge into practice by building a complete motor control system!

Continue to **[Lab 4: Motor Control](../../labs/lab04-motor-control.md)** ğŸ¦¾âš¡

---

**Section Status:** âœ… Complete
**Estimated Reading Time:** 50 minutes
**Hands-On Project:** 3-4 hours (design and build power distribution board)
