---
sidebar_position: 2
title: 2.1.2 Center of Mass & Balance
---

# 2.1.2 Center of Mass & Balance - Keeping Humanoids Upright

## Introduction

**Question:** Why doesn't Tesla Optimus fall over when it walks?

**Answer:** Its center of mass (CoM) always stays within its support polygon (the area defined by its feet).

In this section, you'll learn how to calculate CoM for complex robot systems and design for stability. This is the **fundamental requirement** for bipedal walking, balancing, and manipulation.

---

## What is Center of Mass?

### The Physics

**Center of Mass (CoM):** The point where all mass of a system can be considered concentrated for analyzing translational motion.

**Restaurant Analogy:**
- **Imagine** a restaurant tray with dishes placed on it
- The **CoM** is the point where you could balance the tray on one finger
- If dishes are evenly distributed â†’ CoM is in the center
- If all dishes are on one side â†’ CoM shifts toward that side (tray tips!)

---

### Mathematical Definition

For a system of discrete point masses:

```
CoM_x = (Î£ m_i * x_i) / (Î£ m_i)
CoM_y = (Î£ m_i * y_i) / (Î£ m_i)
CoM_z = (Î£ m_i * z_i) / (Î£ m_i)
```

Where:
- `m_i` = Mass of component i
- `(x_i, y_i, z_i)` = Position of component i's CoM
- `Î£ m_i` = Total mass

**Intuition:** CoM is the mass-weighted average of all component positions.

---

### Example: Simple 2-Link Robot Arm

```
        Link 2 (mâ‚‚ = 0.5 kg, Lâ‚‚ = 0.25 m)
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚             â”‚
        Jointâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Payload (mâ‚ƒ = 1.0 kg)
             â”‚             â”‚
        Link 1 (mâ‚ = 0.8 kg, Lâ‚ = 0.30 m)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
Base    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Setup:**
- Base at origin (0, 0)
- Link 1 CoM at (0.15, 0) - halfway along link
- Link 2 CoM at (0.30 + 0.125, 0) = (0.425, 0)
- Payload at (0.30 + 0.25, 0) = (0.55, 0)

**Calculation:**
```
CoM_x = (0.8Ã—0.15 + 0.5Ã—0.425 + 1.0Ã—0.55) / (0.8 + 0.5 + 1.0)
      = (0.12 + 0.2125 + 0.55) / 2.3
      = 0.882 / 2.3
      = 0.384 m

CoM_total = (0.384, 0)
```

**Insight:** Heavy payload (1 kg) shifts CoM toward the end of the arm.

---

## Center of Pressure vs Center of Mass

### Key Distinction

| Concept | Definition | Importance |
|---------|------------|------------|
| **Center of Mass (CoM)** | Mass-weighted average position | Determines where gravity acts |
| **Center of Pressure (CoP)** | Point where ground reaction force acts | Determines stability |

**Stability Condition:** For a robot to be stable (not tipping), CoP must be within the **support polygon**.

---

### Support Polygon

**Definition:** The convex hull of all contact points with the ground.

**Examples:**

```
Single Foot (Standing)        Two Feet (Standing)          Walking (One Foot)
     Support                    Support Polygon               Support Polygon
      â”Œâ”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”
      â”‚ â–ˆ â”‚                     â”‚      â–ˆ      â”‚               â”‚ â–ˆ â”‚
      â”‚   â”‚                     â”‚             â”‚               â”‚   â”‚
      â””â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”˜
    (Small!)                       (Large!)                  (Small again!)
```

**Key Insight:** Wider stance = larger support polygon = more stable.

---

### Static vs Dynamic Stability

**Static Stability:**
- CoM projected vertically onto ground is within support polygon
- Robot can stand still without falling
- **Example:** Standing humanoid with feet 30cm apart

**Dynamic Stability:**
- CoM may be outside support polygon, but robot doesn't fall because it's moving
- **Example:** Running humanoid (CoM shifts forward, but foot catches it before falling)

**Zero Moment Point (ZMP):**
- Special point on ground where net moment from all forces is zero
- For stable bipedal walking: ZMP must stay within support polygon
- Used by **ASIMO**, **Atlas**, and most walking humanoids

---

## Calculating CoM for Multi-Link Robots

### Step-by-Step Method

**Example:** Humanoid torso with two arms (similar to Lab 2 URDF)

**Robot Specifications:**
```
Torso:        5.0 kg at (0, 0, 0.25)  # 50cm tall, CoM at midpoint
Left arm:     2.0 kg at (-0.20, 0, 0.40)  # Shoulder at 40cm height
Right arm:    2.0 kg at (0.20, 0, 0.40)
Battery pack: 3.0 kg at (0, 0, 0.10)  # Low in torso for stability
```

**Calculation:**
```python
import numpy as np

# Component masses (kg)
masses = np.array([5.0, 2.0, 2.0, 3.0])

# Component CoM positions (x, y, z) in meters
positions = np.array([
    [0.00, 0.00, 0.25],    # Torso
    [-0.20, 0.00, 0.40],   # Left arm
    [0.20, 0.00, 0.40],    # Right arm
    [0.00, 0.00, 0.10]     # Battery
])

# Calculate system CoM
total_mass = np.sum(masses)
CoM = np.sum(masses[:, np.newaxis] * positions, axis=0) / total_mass

print(f"Total mass: {total_mass:.1f} kg")
print(f"CoM position: ({CoM[0]:.3f}, {CoM[1]:.3f}, {CoM[2]:.3f}) m")
```

**Output:**
```
Total mass: 12.0 kg
CoM position: (0.000, 0.000, 0.246) m
```

**Analysis:**
- CoM is centered horizontally (X=0, Y=0) because arms are symmetric
- CoM height (Z=0.246m) is slightly below torso midpoint due to heavy battery low in torso
- **Design Goal Achieved:** Low CoM improves stability!

---

## Designing for Stability

### Golden Rules

1. **Low CoM is Good**
   - Place heavy components (batteries, motors) low in the structure
   - Reduces tip-over risk
   - **Example:** Unitree G1 battery pack is in the pelvis, not the chest

2. **Symmetric Mass Distribution**
   - Left/right symmetry prevents leaning
   - **Example:** If left arm is heavier, robot will list to the left

3. **CoM Above Support Polygon**
   - For static stability, CoM must project into support polygon
   - **Rule of Thumb:** CoM height should be < 2Ã— foot length
   - **Example:** 30cm foot â†’ CoM should be < 60cm height for easy balancing

---

### Case Study: Boston Dynamics Atlas

**Atlas Specifications:**
- Height: 1.5 m
- Mass: 89 kg
- CoM height (upright): ~0.85 m (57% of total height)
- Foot length: 0.28 m

**Stability Analysis:**
```
CoM height / Foot length = 0.85 / 0.28 = 3.0
```

**Observation:** This ratio is > 2, which seems unstable! How does Atlas walk?

**Answer:** **Dynamic stability** - Atlas constantly adjusts foot placement and uses its arms to shift CoM. It doesn't rely on static stability.

**Lesson:** Humanoids use active control to maintain balance, unlike passive stability of wheeled robots.

---

## Computing CoM from URDF

### Extracting Mass Properties

In Module 1, you defined URDF links with `<inertial>` tags:

```xml
<link name="torso">
  <inertial>
    <origin xyz="0 0 0.25" rpy="0 0 0"/>
    <mass value="5.0"/>
    <inertia ixx="0.104" ixy="0" ixz="0"
             iyy="0.156" iyz="0" izz="0.073"/>
  </inertial>
  <!-- visual and collision omitted -->
</link>
```

**Key Data:**
- `<mass value="5.0"/>` â†’ m = 5.0 kg
- `<origin xyz="0 0 0.25"/>` â†’ CoM position relative to link frame

---

### Python Script: CoM from URDF

```python
import xml.etree.ElementTree as ET
import numpy as np

def parse_urdf_com(urdf_file):
    """Extract CoM from URDF file"""
    tree = ET.parse(urdf_file)
    root = tree.getroot()

    masses = []
    positions = []

    for link in root.findall('link'):
        inertial = link.find('inertial')
        if inertial is None:
            continue  # Skip links without mass (visual-only)

        # Extract mass
        mass_elem = inertial.find('mass')
        mass = float(mass_elem.get('value'))

        # Extract CoM position
        origin = inertial.find('origin')
        xyz = origin.get('xyz').split()
        position = np.array([float(xyz[0]), float(xyz[1]), float(xyz[2])])

        masses.append(mass)
        positions.append(position)

    # Calculate system CoM
    masses = np.array(masses)
    positions = np.array(positions)

    total_mass = np.sum(masses)
    com = np.sum(masses[:, np.newaxis] * positions, axis=0) / total_mass

    return total_mass, com

# Example usage
total_mass, com = parse_urdf_com("humanoid_torso.urdf")
print(f"Robot total mass: {total_mass:.2f} kg")
print(f"Robot CoM: ({com[0]:.3f}, {com[1]:.3f}, {com[2]:.3f}) m")
```

**Note:** This script assumes all links are in the same frame (root frame). For a complete solution, you'd need to use the `robot_state_publisher` TF tree to transform each link's CoM to the world frame.

---

## Dynamic CoM During Motion

### The Challenge

When a humanoid moves, link positions change â†’ CoM shifts!

**Example:** Raising right arm from rest to horizontal

```
Before (arms down):              After (right arm raised):
       CoM                             CoM shifts right + up
        â†“                                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”€â”€â”€
    â”‚   â–ˆ   â”‚                          â”‚   â–ˆ   â”‚    â†‘
    â”‚ â•±   â•² â”‚                          â”‚ â•±   â”€ â”‚    â† Right arm
    â”‚       â”‚                          â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Consequence:** Robot must shift weight to left foot to maintain balance!

---

### Forward Kinematics for CoM

**Algorithm:**
1. For each joint configuration Î¸ = [Î¸â‚, Î¸â‚‚, ..., Î¸â‚™]:
   - Use forward kinematics to compute link positions
   - Compute CoM as weighted average of link CoMs
2. Check if CoM projection is within support polygon
3. If not â†’ adjust joint angles or foot placement

**Simplified 2D Example:**

```python
import numpy as np

def compute_com_2link_arm(theta1, theta2, L1=0.3, L2=0.25):
    """
    Compute CoM for 2-link arm
    theta1: shoulder angle (rad)
    theta2: elbow angle (rad)
    L1, L2: link lengths (m)
    """
    # Link masses (kg)
    m1, m2 = 0.8, 0.5

    # Link 1 CoM position (halfway along link)
    x1 = (L1/2) * np.cos(theta1)
    y1 = (L1/2) * np.sin(theta1)

    # Link 2 CoM position
    x2 = L1 * np.cos(theta1) + (L2/2) * np.cos(theta1 + theta2)
    y2 = L1 * np.sin(theta1) + (L2/2) * np.sin(theta1 + theta2)

    # System CoM
    com_x = (m1 * x1 + m2 * x2) / (m1 + m2)
    com_y = (m1 * y1 + m2 * y2) / (m1 + m2)

    return com_x, com_y

# Test: Arm horizontal
theta1 = np.pi/2  # Shoulder raised 90Â°
theta2 = 0        # Elbow straight

com_x, com_y = compute_com_2link_arm(theta1, theta2)
print(f"CoM when arm is horizontal: ({com_x:.3f}, {com_y:.3f}) m")
```

**Output:**
```
CoM when arm is horizontal: (0.000, 0.273) m
```

**Interpretation:** CoM shifts upward when arm is raised (Y increases).

---

## Stability Margin

### Quantifying Balance

**Stability Margin:** Distance from CoM projection to edge of support polygon.

**Formula:**
```
Margin = min(distance(CoM_projection, polygon_edge))
```

**Interpretation:**
- Margin > 0.1 m â†’ Very stable (can handle 100+ N push)
- Margin = 0.05 m â†’ Marginally stable
- Margin < 0 â†’ Unstable! (robot will tip)

---

### Example: Humanoid Standing

```
Support Polygon (two feet):
  Foot 1: (0, 0.15) â”€â”€â”€â”€â”€â”€â”€â”
  Foot 2: (0, -0.15)        â”‚  30cm stance width
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CoM projection: (0.02, 0)  # Slightly off-center
```

**Stability Margin Calculation:**
```python
# Distance from CoM to nearest edge
distance_to_left = abs(0.02 - (-0.15)) = 0.17 m
distance_to_right = abs(0.02 - 0.15) = 0.13 m

stability_margin = min(0.17, 0.13) = 0.13 m âœ…
```

**Conclusion:** Robot is stable with 13cm margin.

---

## Optimizing Mass Distribution

### Design Strategies

**Strategy 1: Battery Placement**

**Bad Design:**
```
Battery in head (high CoM):
    â”Œâ”€â”€â”€â”€â”€â”
    â”‚ ğŸ”‹  â”‚ â† 3 kg battery
    â”œâ”€â”€â”€â”€â”€â”¤
    â”‚     â”‚
    â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”˜
CoM height: 0.95 m (high!)
```

**Good Design:**
```
Battery in pelvis (low CoM):
    â”Œâ”€â”€â”€â”€â”€â”
    â”‚     â”‚
    â”œâ”€â”€â”€â”€â”€â”¤
    â”‚ ğŸ”‹  â”‚ â† 3 kg battery
    â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”˜
CoM height: 0.55 m (low!)
```

**Impact:** 40cm lower CoM â†’ 2Ã— larger tipping angle tolerance.

---

**Strategy 2: Symmetric Arm Design**

**Problem:** Asymmetric mass distribution causes listing.

**Solution:**
- Ensure left and right arms have identical mass
- Place heavy components (motors) symmetrically
- Use lightweight materials for non-structural parts

**Example:** Unitree G1 uses identical actuators in both arms (3.2 kg each).

---

**Strategy 3: Counterweights**

**Use Case:** Robot needs to hold heavy tool in one hand.

**Without Counterweight:**
```
       Tool (5 kg)
          â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â–ˆ  â—â”€â”˜  â† Right arm extended
    â”‚  â•±
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    CoM shifts right â†’ tips over!
```

**With Counterweight:**
```
Counterweight (5 kg)       Tool (5 kg)
    â†“                          â†“
    â””â”€â—  â–ˆ  â—â”€â”˜  â† Left arm holds weight
       â•±   â•²

    CoM stays centered â†’ stable!
```

**Application:** Construction robots, warehouse humanoids.

---

## Moment of Inertia (Rotational Mass)

### Beyond CoM: Rotational Dynamics

**CoM** describes translational behavior, but humanoids also **rotate** (turning, balancing).

**Moment of Inertia (I):** Resistance to rotational acceleration (like mass for rotation).

**Formula (discrete masses):**
```
I = Î£ m_i * r_iÂ²
```

Where:
- `r_i` = Distance from rotation axis to mass i
- `m_i` = Mass of component i

**Intuition:** Mass far from rotation axis contributes more to inertia (harder to spin).

---

### Example: Humanoid Spinning

**Scenario:** Robot spins around vertical axis (yaw rotation).

**Configuration A:** Arms extended outward
```
   â—â”€â”€â”€â”€â”€â—      â† Arms extended
      â–ˆ
     â•± â•²
   â—     â—

I â‰ˆ 12 kgÂ·mÂ² (high moment of inertia)
```

**Configuration B:** Arms pulled inward
```
     â—â”€â—        â† Arms tucked in
      â–ˆ
     â•± â•²
   â—     â—

I â‰ˆ 3 kgÂ·mÂ² (low moment of inertia)
```

**Observation:** Configuration B spins 4Ã— faster for same torque (like ice skater pulling arms in!).

**Design Implication:** For agile turning, keep arm mass close to torso.

---

## Summary

### Key Takeaways

1. âœ… **CoM** is the mass-weighted average of all link positions
2. âœ… **Low CoM** improves stability (place heavy batteries low)
3. âœ… **Support polygon** determines static stability (wider stance = more stable)
4. âœ… **Dynamic stability** (used by humanoids) allows CoM outside support polygon during motion
5. âœ… **Stability margin** quantifies how close a robot is to tipping

---

### Design Checklist

When designing a humanoid robot, ensure:

- [ ] CoM is low (< 60% of total height for static stability)
- [ ] Left/right mass distribution is symmetric (< 5% difference)
- [ ] Battery pack is in pelvis or lower torso
- [ ] Heavy actuators are close to joints (minimize moment of inertia)
- [ ] CoM projection stays within support polygon during all planned motions
- [ ] Stability margin > 0.05 m in standing pose

---

## Practice Problems

### Problem 1: CoM Calculation

**Given:** A robot with the following components:
- Torso: 6 kg at (0, 0, 0.40)
- Left arm: 1.5 kg at (-0.25, 0, 0.50)
- Right arm: 1.5 kg at (0.25, 0, 0.50)
- Left leg: 3 kg at (-0.10, 0, 0.20)
- Right leg: 3 kg at (0.10, 0, 0.20)
- Battery: 4 kg at (0, 0, 0.15)

**Calculate:**
1. Total mass
2. CoM position (X, Y, Z)
3. Is the CoM centered horizontally?

---

### Problem 2: Stability Margin

**Scenario:** Humanoid standing with:
- Feet at (0, Â±0.12) â†’ support polygon width = 0.24 m
- CoM at (0.08, 0, 0.65)

**Questions:**
1. What is the stability margin?
2. Can the robot withstand a 50 N lateral push? (Assume push creates 50 N Ã— 0.65 m = 32.5 Nm moment)
3. How could you increase stability margin?

---

### Problem 3: Dynamic CoM (Coding)

**Task:** Extend the 2-link arm CoM script to include:
1. Payload mass at end-effector
2. Plot CoM trajectory as arm sweeps from Î¸â‚=0Â° to Î¸â‚=180Â°
3. Identify configuration with highest CoM

---

## Further Reading

### Recommended Resources

**Books:**
- "Humanoid Robotics: A Reference" - Goswami & Vadakkepat (Chapter 4: Balance and Stability)
- "Introduction to Humanoid Robotics" - Kajita et al. (ZMP Theory)

**Papers:**
- "The Zero Moment Point: Thirty Years After" - VukobratoviÄ‡ & Borovac (Classic ZMP paper)
- "Push Recovery by Stepping for Humanoid Robots with Force Controlled Joints" - Stephens & Atkeson

**Videos:**
- Boston Dynamics Atlas: Balance Recovery (YouTube) - See CoM control in action
- MIT Mini Cheetah: "How Legged Robots Balance" (MIT OpenCourseWare)

---

## Next Section

Now that you understand how to optimize individual links and balance the overall system, it's time to choose the right **materials**.

Continue to **[Section 2.1.3: Material Selection](./2.1.3-material-selection.md)** to learn when to use carbon fiber, aluminum, or 3D printed plastics! ğŸ—ï¸âš™ï¸

---

**Section Status:** âœ… Complete
**Estimated Reading Time:** 40 minutes
**Hands-On Coding:** 25 minutes
